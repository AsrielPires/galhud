"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.select = exports.number = exports.radio = exports.text = exports.addBaseTypes = exports.addcbFmts = exports.cbFormats = exports.output = exports.input = exports.size = exports.set = exports.sort = exports.query = void 0;
const entity_1 = require("entity");
const inputs_1 = require("form/inputs");
const format_1 = require("format");
const scalar_1 = require("format/scalar");
const time_1 = require("format/time");
const galhui_1 = require("galhui");
const inutil_1 = require("inutil");
// export class Field<T extends FieldOpts = FieldOpts> implements IField {
//   constructor(public key: str, public tp: Key, public o: T = <T>{}) {
//     this.req = t(o.req);
//     this.edit = def(o.edit, set(this));
//     this.side = o.side;
//   }
// }
const field = (key, tp, opts) => (0, inutil_1.ex)({ key, tp }, opts);
const query = ({ query, tp }) => (0, inutil_1.def)(query, entity_1.fieldTypes[tp].query);
exports.query = query;
const sort = ({ sort, tp }) => (0, inutil_1.def)(sort, entity_1.fieldTypes[tp].sort);
exports.sort = sort;
const set = ({ set, tp }) => (0, inutil_1.def)(set, entity_1.fieldTypes[tp].set);
exports.set = set;
const size = ({ tp }) => entity_1.fieldTypes[tp].size() * galhui_1.$.rem;
exports.size = size;
const input = (f) => entity_1.fieldTypes[f.tp].input(f);
exports.input = input;
const output = (f, ctx) => entity_1.fieldTypes[f.tp].output(ctx, f);
exports.output = output;
// export const extendField = (base: Key, key: Key, type: FieldType) =>
//   types[key] = extend(type, types[base]);
const defFT = {
    sort: true,
    block: false,
    query: true,
    align: "left",
    set: true,
    output: ({ v, p }) => v == null ? p.null : v,
    size: () => 10
};
/**checkbox format */
exports.cbFormats = {};
const addcbFmts = (list) => (0, inutil_1.ex)(list, {
    icon: (value) => (0, galhui_1.icon)((0, inutil_1.isV)(value) ? value ? galhui_1.$.i.check : galhui_1.$.i.close : galhui_1.$.null()),
    /**yes | no */
    yn: (value) => (0, inutil_1.isV)(value) ? value ? galhui_1.w.yes : galhui_1.w.no : "",
    /**true | false */
    tf: (value) => (0, inutil_1.isV)(value) ? value ? galhui_1.w.true : galhui_1.w.false : "",
});
exports.addcbFmts = addcbFmts;
function addBaseTypes(types) {
    const addType = (key, type) => types[key] = (0, inutil_1.extend)(type, defFT);
    addType("text", {
        input: (i) => new inputs_1.TextInput(i),
        size: () => 12
    });
    addType("number", {
        output: ({ v, p }, o) => v == null ? p.null : (0, scalar_1.default)(v).fmt(o.fmt || p.numberFmt),
        input: (i) => new inputs_1.NumberInput(i),
        size: () => 7,
        align: "right"
    });
    addType("date", {
        output: ({ v, p }, o) => v == null ? p.null : (0, time_1.formatTime)((0, format_1.time)(v), o.fmt || p.dateFmt),
        input: ({ key, req, input }) => (0, inputs_1.date)(key, input, req)
    });
    addType("time", {
        output: ({ v, p }, o) => v == null ? p.null : (0, time_1.formatTime)((0, format_1.time)(v), o.fmt || p.timeFmt),
        input: ({ key, req }) => (0, inputs_1.time)(key, req)
    });
    addType("dt", {
        output: ({ v, p }, o) => v == null ? p.null : (0, time_1.formatTime)((0, format_1.time)(v), o.fmt),
        input: () => null
    });
    addType("check", {
        output: ({ v, p }, o) => exports.cbFormats[o.fmt || p.checkboxFmt](v),
        input: ({ key, req }) => (0, inputs_1.checkbox)(key, req)
    });
    addType("radio", {
        output: ({ v, p }, o) => v == null ? p.null : entity_1.$.enumView(o.src, v),
        input: ({ key, req, src }) => new inputs_1.RadioInput({ key, options: entity_1.$.enum(src), req }),
        init(o) { entity_1.$.enum(o.src); },
        size: () => 4
    });
}
exports.addBaseTypes = addBaseTypes;
const text = (key, opts = {}) => field(key, "text", opts);
exports.text = text;
const radio = (key, list, opts) => field(key, "radio", (0, inutil_1.ex)({}, { enum: list }, opts));
exports.radio = radio;
const number = (key, opts = {}) => field(key, "number", opts);
exports.number = number;
const select = (key, link, opts) => field(key, "link", (0, inutil_1.ex)({}, opts, { link }));
exports.select = select;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmllbGRzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZmllbGRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLG1DQUFrRztBQUVsRyx3Q0FFcUI7QUFDckIsbUNBQThCO0FBQzlCLDBDQUFtQztBQUNuQyxzQ0FBeUM7QUFDekMsbUNBQTJDO0FBRzNDLG1DQUE4QztBQTZDOUMsMEVBQTBFO0FBQzFFLHdFQUF3RTtBQUN4RSwyQkFBMkI7QUFDM0IsMENBQTBDO0FBQzFDLDBCQUEwQjtBQUMxQixNQUFNO0FBQ04sSUFBSTtBQUNKLE1BQU0sS0FBSyxHQUFHLENBQTBCLEdBQVEsRUFBRSxFQUFPLEVBQUUsSUFBaUIsRUFBUyxFQUFFLENBQUMsSUFBQSxXQUFFLEVBQUksRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFPLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDL0csTUFBTSxLQUFLLEdBQUcsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQVMsRUFBRSxFQUFFLENBQUMsSUFBQSxZQUFHLEVBQUMsS0FBSyxFQUFFLG1CQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7QUFBOUQsUUFBQSxLQUFLLFNBQXlEO0FBQ3BFLE1BQU0sSUFBSSxHQUFHLENBQUMsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFTLEVBQUUsRUFBRSxDQUFDLElBQUEsWUFBRyxFQUFDLElBQUksRUFBRSxtQkFBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQTFELFFBQUEsSUFBSSxRQUFzRDtBQUNoRSxNQUFNLEdBQUcsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBUyxFQUFFLEVBQUUsQ0FBQyxJQUFBLFlBQUcsRUFBQyxHQUFHLEVBQUUsbUJBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUF0RCxRQUFBLEdBQUcsT0FBbUQ7QUFDNUQsTUFBTSxJQUFJLEdBQUcsQ0FBQyxFQUFFLEVBQUUs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