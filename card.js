"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.card = void 0;
const entity_1 = require("entity");
const galho_1 = require("galho");
const list_1 = require("galhui/list");
const io_1 = require("galhui/io");
const inutil_1 = require("inutil");
const fields_1 = require("./fields");
function card(link) {
    let e = link.target, main = (0, entity_1.field)(e, f => !e.main || f.key == e.main), bf = link.fields, tags = (0, entity_1.fields)(e, (f) => (bf.length ? bf.includes(f.key) : !f.side) && f.key != main.key), p = list_1.defRenderer;
    bf.length || bf.set((0, inutil_1.distinct)([main.key, ...tags.map(t => t.key), /*...fmt ? fmtFields(fmt) : []*/]));
    return (r) => {
        let ctx = { p }, s = (0, galho_1.div)("_ card", [
            (0, galho_1.wrap)((0, fields_1.output)(main, (0, inutil_1.ex)(ctx, { v: r[main.key] })), null, 'p'),
            tags.map((t) => r[t.key] == null ? null : (0, io_1.keyVal)(t.text, (0, fields_1.output)(t, (0, inutil_1.ex)(ctx, { v: r[t.key] }))))
        ]);
        //fmt && format(value, s, fmt)
        return s;
    };
}
exports.card = card;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FyZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNhcmQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsbUNBQW9EO0FBRXBELGlDQUFrQztBQUNsQyxzQ0FBcUQ7QUFDckQsa0NBQW1DO0FBQ25DLG1DQUFzQztBQUN0QyxxQ0FBa0M7QUFFbEMsU0FBZ0IsSUFBSSxDQUFDLElBQVU7SUFDN0IsSUFDRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFDZixJQUFJLEdBQVUsSUFBQSxjQUFLLEVBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUN2RCxFQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFDaEIsSUFBSSxHQUFHLElBQUEsZUFBTSxFQUFDLENBQUMsRUFBRSxDQUFDLENBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQy9GLENBQUMsR0FBRyxrQkFBVyxDQUFDO0lBRWxCLEVBQUUsQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFBLGlCQUFRLEVBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxnQ0FBZ0MsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUVyRyxPQUFPLENBQUMsQ0FBTSxFQUFFLEVBQUU7UUFDaEIsSUFDRSxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQWUsRUFDeEIsQ0FBQyxHQUFHLElBQUEsV0FBRyxFQUFDLFFBQVEsRUFBRTtZQUNoQixJQUFBLFlBQUksRUFBQyxJQUFBLGVBQU0sRUFBQyxJQUFJLEVBQUUsSUFBQSxXQUFFLEVBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQztZQUMxRCxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBUSxFQUFFLEVBQUUsQ0FDcEIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBQSxXQUFNLEVBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFBLGVBQU0sRUFBQyxDQUFDLEVBQUUsSUFBQSxXQUFFLEVBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNqRixDQUFDLENBQUM7UUFDTCw4QkFBOEI7UUFDOUIsT0FBTyxDQUFDLENBQUM7SUFDWCxDQUFDLENBQUE7QUFDSCxDQUFDO0FBckJELG9CQXFCQyJ9