"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.printDoc = exports.docView = void 0;
const book_1 = require("book");
const fn_1 = require("book/fn");
const entity_1 = require("entity");
const format_1 = require("format");
const galho_1 = require("galho");
const galhui_1 = require("galhui");
const hover_1 = require("galhui/hover");
const inutil_1 = require("inutil");
const fields_1 = require("./fields");
async function docView(obj, { dt, extra = {}, o, media, double, triple }) {
    (0, book_1.normalize)(obj);
    let bd = (0, galho_1.g)("div", "bd" /* body */), [w, h] = book_1.medias[media], calc = (0, book_1.cpu)(), 
    // img = (path: str, args?: Dic) => $.img()`${$.host}\\${path}?${args ? dta(args, (v, k) => `${k}=${v}`).join('&') : ''}`,
    symbs = {}, view = (dt) => (0, book_1.sheets)({
        dt: (0, inutil_1.ex)(dt, extra),
        fmt: format_1.default, calc,
        img: galhui_1.$.img, symb: (key) => symbs[key]
    }, bd, obj, w, h);
    (0, hover_1.openBody)((0, hover_1.modal)(), bd, [(0, galhui_1.ibutton)("printer", galhui_1.w.print, () => (0, book_1.print)(bd, o, media, window.print))], { cls: "full" /* full */ });
    if (obj.symbs)
        for (let symb of obj.symbs)
            symbs[symb] = await galhui_1.$.rsc(symb);
    if (obj.q)
        for (let k in obj.q)
            extra[k] = await galhui_1.$.api(`/${obj.q[k]}`);
    for (let t of dt) {
        t.copy = galhui_1.w.original;
        await view(t);
        if (double) {
            t.copy = galhui_1.w.double;
            await view(t);
            if (triple) {
                t.copy = galhui_1.w.triple;
                await view(t);
            }
        }
    }
}
exports.docView = docView;
async function printList(bond) {
    let ent = bond.target, fs = (0, entity_1.fields)(ent, f => bond.fields.includes(f.key));
    docView({
        hd: (0, fn_1.symb)("doc-hd"),
        dt: (0, inutil_1.ex)((0, fn_1.tbh)(fs.map(f => (0, fields_1.size)(f)), (0, fn_1.th)((0, fn_1.cs)((0, fn_1.p)(galhui_1.w.e[ent.key].p), { al: "center" }), ...fs.map(f => (0, fn_1.cs)((0, fn_1.p)(f.text), { al: entity_1.fieldTypes[f.tp].align }))), (0, fn_1.tr)(...fs.map(f => (0, fn_1.cs)((0, fn_1.s)(f.text), { al: entity_1.fieldTypes[f.tp].align })))), { map: true }),
        ft: (0, fn_1.symb)("doc-ft")
    }, { dt: [await bond.getAll()], media: "A4" });
}
async function printDoc(key, dt) {
    await docView(await galhui_1.$.doc(key), { dt, o: "v", media: "A4" });
}
exports.printDoc = printDoc;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9jLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZG9jLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLCtCQUFrRztBQUNsRyxnQ0FBc0Q7QUFDdEQsbUNBQWdFO0FBQ2hFLG1DQUF5QjtBQUN6QixpQ0FBMEI7QUFDMUIsbUNBQXNEO0FBQ3RELHdDQUErQztBQUMvQyxtQ0FBNEI7QUFDNUIscUNBQWdDO0FBc0N6QixLQUFLLFVBQVUsT0FBTyxDQUFDLEdBQVMsRUFBRSxFQUFFLEVBQUUsRUFBRSxLQUFLLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBVztJQUM1RixJQUFBLGdCQUFTLEVBQUMsR0FBRyxDQUFDLENBQUM7SUFFZixJQUNFLEVBQUUsR0FBRyxJQUFBLFNBQUMsRUFBQyxLQUFLLGtCQUFTLEVBQ3JCLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLGFBQU0sQ0FBQyxLQUFLLENBQUMsRUFDdEIsSUFBSSxHQUFHLElBQUEsVUFBRyxHQUFFO0lBQ1osMEhBQTBIO0lBQzFILEtBQUssR0FBZSxFQUFFLEVBQ3RCLElBQUksR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsSUFBQSxhQUFNLEVBQUM7UUFDcEIsRUFBRSxFQUFFLElBQUEsV0FBRSxFQUFDLEVBQUUsRUFBRSxLQUFLLENBQUM7UUFDakIsR0FBRyxFQUFILGdCQUFHLEVBQUUsSUFBSTtRQUNULEdBQUcsRUFBRSxVQUFDLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQztLQUN0QyxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBRXBCLElBQUEsZ0JBQVEsRUFBQyxJQUFBLGFBQUssR0FBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLElBQUEsZ0JBQU8sRUFBQyxTQUFTLEVBQUUsVUFBSyxDQUFD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